<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log√≠stica Pro - Vis√£o Financeira Completa</title>
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    
    <link rel="stylesheet" href="style.css?v=1.0.2">
    <style>
        /* Ajustes espec√≠ficos para o novo layout de colunas */
        .wrapper {
            display: flex;
            height: 100vh;
            flex-direction: row;
            overflow: hidden;
        }

        .sidebar {
            width: 25%;
            min-width: 320px;
            height: 100%;
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
            z-index: 10;
        }

        #painel-custos-extra {
            display: none;
            width: 25%;
            min-width: 320px;
            height: 100%;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            z-index: 10;
        }
    </style>
</head>
<body>

<nav class="top-nav">
    <div class="nav-links">
        <a onclick="toggleDarkMode()">üåì Modo</a>
        <a onclick="toggleFrota()">üöõ Frota</a>
        <a onclick="toggleGoogleMaps()">üó∫Ô∏è Roteiro AE</a>
    </div>
    <div style="font-weight: 800; color: var(--accent); letter-spacing: 1px;">LOG√çSTICA PRO V2</div>
</nav>

<div class="wrapper">
    <div class="sidebar" id="sidebar-main">
        <div class="header-sidebar">
            <h2>Configura√ß√£o de Rota</h2>
        </div>

        <div id="msg-erro" class="alerta-erro"></div>

        <label class="label-custo">In√≠cio da Viagem (Sa√≠da)</label>
        <input type="text" id="saida" class="input-moderno" placeholder="Cidade ou Endere√ßo de Sa√≠da">

        <div id="container-config-deslocamento" class="deslocamento-config" style="display: none; flex-direction: column; background: rgba(37, 99, 235, 0.05); border: 1px dashed var(--accent); padding: 12px; border-radius: 8px; margin-bottom: 15px;">
            <label class="label-custo" style="color: var(--accent);">Configura√ß√£o de Deslocamento</label>
            <select id="tipoDeslocamento" class="input-moderno" style="margin-bottom: 8px;">
                <option value="nao_remunerado">N√£o Remunerado (Vazio)</option>
                <option value="remunerado_km">Remunerado por KM</option>
                <option value="remunerado_rs">Remunerado Valor Fixo (R$)</option>
            </select>
            <input type="number" id="valorDeslocamentoKm" class="input-moderno" placeholder="R$ por KM" style="display:none;">
            <input type="number" id="valorDeslocamentoTotal" class="input-moderno" placeholder="Valor Total R$" style="display:none;">
        </div>
        <label class="label-custo">Pontos de Coleta/Entrega</label>
        <ul id="lista-pontos" class="lista-pontos">
            </ul>

        <button class="btn-add" onclick="adicionarPonto()">+ Adicionar Ponto</button>

        <label class="label-custo">Valor do Frete Base (R$)</label>
        <input type="number" id="valor-frete" class="input-moderno" placeholder="Ex: 5000">

        <button class="calc-btn" onclick="iniciarCalculo()">Calcular Viagem</button>

        <div class="financeiro">
            <div class="row">Dist√¢ncia Total <span id="txt-dist-total">0 km</span></div>
            <div class="row">
                Dist√¢ncia em Vazio 
                <div style="text-align: right;">
                    <span id="txt-dist-vazio">0 km</span>
                    <span id="detalhe-km-vazio" class="km-breakdown" style="display: block; font-size: 11px; color: var(--text-sub); font-style: italic;"></span>
                </div>
            </div>
            
            <div class="container-barra">
                <div id="visual-vazio" class="barra-vazio" style="width: 0%"></div>
                <div id="visual-rota" class="barra-rota" style="width: 100%"></div>
            </div>
            <div class="barra-labels">
                <span id="perc-vazio">0% Vazio</span>
                <span id="perc-rota">100% Rota</span>
            </div>

            <div class="frete-destaque">
                <span class="destaque-label">RECEITA BRUTA TOTAL</span>
                <span id="txt-frete-total">R$ 0,00</span>
                <span id="detalhe-receita-deslocamento" class="km-breakdown" style="display: block; font-size: 11px; color: var(--text-sub); font-style: italic;"></span>
            </div>
        </div>
        
        <button class="calc-btn" style="margin-top:15px; background: #64748b;" onclick="toggleCustos()">Configurar Custos Extras</button>
    </div>

    <div id="painel-custos-extra">
        <div class="header-sidebar">
            <h2>Custos Operacionais</h2>
        </div>

        <div class="secao-custo">
            <label class="label-custo">Diesel e Arla</label>
            <div class="grid-configs">
                <div>
                    <span class="sub-label">Pre√ßo Diesel (L)</span>
                    <input type="number" id="custoDieselLitro" class="input-moderno" placeholder="R$">
                </div>
                <div>
                    <span class="sub-label">M√©dia (KM/L)</span>
                    <input type="number" id="consumoDieselMedia" class="input-moderno" placeholder="KM/L">
                </div>
            </div>
            <div class="grid-configs">
                <div>
                    <span class="sub-label">Pre√ßo Arla (L)</span>
                    <input type="number" id="custoArlaLitro" class="input-moderno" placeholder="R$">
                </div>
                <div>
                    <span class="sub-label">% Arla/Diesel</span>
                    <input type="number" id="arlaPorcentagem" class="input-moderno" value="5">
                </div>
            </div>
        </div>

        <div class="secao-custo">
            <label class="label-custo">Ped√°gio e Manuten√ß√£o</label>
            <div class="grid-configs">
                <div>
                    <span class="sub-label">Total Ped√°gio</span>
                    <input type="number" id="custoPedagio" class="input-moderno" placeholder="R$">
                </div>
                <div>
                    <span class="sub-label">Manut. por KM</span>
                    <input type="number" id="custoManutencaoKm" class="input-moderno" placeholder="R$">
                </div>
            </div>
        </div>

        <div class="financeiro-extra">
            <div class="row-destaque">Resultado da Opera√ß√£o</div>
            <div class="row">Diesel <span id="txt-an-diesel">R$ 0,00</span></div>
            <div class="row">Arla 32 <span id="txt-an-arla">R$ 0,00</span></div>
            <div class="row">Ped√°gio <span id="txt-an-pedagio">R$ 0,00</span></div>
            <div class="row">Manuten√ß√£o <span id="txt-an-manutencao">R$ 0,00</span></div>
            <div class="row">Comiss√£o <span id="txt-an-comissao">R$ 0,00</span></div>

            <div class="frete-destaque lucro-destaque" id="destaque-lucro">
                <span class="destaque-label">LUCRO ESTIMADO</span>
                <span id="txt-lucro-real">R$ 0,00</span>
            </div>
        </div>
        <button class="calc-btn" style="margin-top:15px;" onclick="toggleCustos()">Voltar para Rota</button>
    </div>

    <div class="map-container">
        <div id="map" style="height: 100%; width: 100%;"></div>
        
        <div id="painel-roteiro-escrito">
            <div class="header-roteiro">
                <h2>Resumo do Percurso (Estilo AE)</h2>
                <span style="cursor:pointer; font-size:24px;" onclick="toggleGoogleMaps()">&times;</span>
            </div>
            <div id="lista-passo-a-passo">
                <p style="padding: 20px; color: var(--text-sub);">Calcule uma rota para ver o roteiro detalhado.</p>
            </div>
        </div>
    </div>
</div>

<div id="painel-frota">
    <div style="display:flex; justify-content: space-between;">
        <span id="frota-titulo">Minha Frota</span>
        <span style="cursor:pointer; font-size:24px;" onclick="toggleFrota()">&times;</span>
    </div>
    <input type="text" id="f-nome" class="input-moderno" placeholder="Nome do Ve√≠culo (Ex: Scania R450)">
    <div class="grid-configs">
        <input type="number" id="f-media" class="input-moderno" placeholder="M√©dia KM/L">
        <input type="number" id="f-manut" class="input-moderno" placeholder="Manut R$/KM">
    </div>
    <button class="calc-btn" onclick="salvarVeiculo()">Adicionar Ve√≠culo</button>
    
    <div class="lista-frota-content" id="lista-frota">
        </div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=SUA_CHAVE_AQUI&callback=initMap&libraries=places" async defer></script>
<script src="script.js?v=1.0.2"></script>

</body>
</html>
